<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HoN Matchups</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React / ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transform -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-slate-50 text-slate-900 antialiased">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect, useRef } = React;

      // ====== Héroes disponibles ======
      const HEROES = [
        "Pebbles","Magmus","Witch Slayer","Forsaken Archer","Andromeda",
        "Electrician","Hammerstorm","Predator","Deadwood","Engineer",
        "Amun-Ra","Armadon","Swiftblade"
      ];

      // ====== Matchups ======
      const MATCHUPS = {
        "Witch Slayer": { synergy: ["Amun-Ra"], advantage: ["Armadon"], disadvantage: ["Swiftblade"] },
        Pebbles: { synergy: [], advantage: [], disadvantage: [] },
        Magmus: { synergy: [], advantage: [], disadvantage: [] },
        "Forsaken Archer": { synergy: [], advantage: [], disadvantage: [] },
        Andromeda: { synergy: [], advantage: [], disadvantage: [] },
        Electrician: { synergy: [], advantage: [], disadvantage: [] },
        Hammerstorm: { synergy: [], advantage: [], disadvantage: [] },
        Predator: { synergy: [], advantage: [], disadvantage: [] },
        Deadwood: { synergy: [], advantage: [], disadvantage: [] },
        Engineer: { synergy: [], advantage: [], disadvantage: [] },
        "Amun-Ra": { synergy: [], advantage: [], disadvantage: [] },
        Armadon: { synergy: [], advantage: [], disadvantage: [] },
        Swiftblade: { synergy: [], advantage: [], disadvantage: [] }
      };

      // ====== Config imágenes locales ======
      const IMAGE_BASE = "/assets/hon";
      const IMAGE_EXTS = ["webp","png","jpg"];

      function Avatar({ name, size = 24 }) {
        const [extIndex, setExtIndex] = useState(0);
        const url = `${IMAGE_BASE}/${name.replace(/\s+/g, "_")}.${IMAGE_EXTS[extIndex]}`;
        const initials = name.split(" ").map(p => p[0]).join("").slice(0,2).toUpperCase();
        const dim = `${size}px`;
        const tryNext = () => setExtIndex(i => (i < IMAGE_EXTS.length - 1 ? i + 1 : i));
        return (
          <div style={{ width: dim, height: dim }} className="inline-flex items-center justify-center rounded-lg bg-slate-200 text-slate-700 overflow-hidden flex-shrink-0">
            {extIndex < IMAGE_EXTS.length ? (
              <img
                src={url}
                alt={name}
                decoding="async"
                referrerPolicy="no-referrer"
                onError={tryNext}
                style={{ width: "100%", height: "100%", objectFit: "cover" }}
              />
            ) : (
              <span style={{ fontSize: size > 32 ? 14 : 12 }} className="font-semibold">{initials}</span>
            )}
          </div>
        );
      }

      function classNames(...cls) {
        return cls.filter(Boolean).join(" ");
      }

      function App() {
        const [query, setQuery] = useState("");
        const [open, setOpen] = useState(false);
        const [highlight, setHighlight] = useState(0);
        const [selected, setSelected] = useState(null);
        const containerRef = useRef(null);

        const filtered = useMemo(() => {
          const q = query.trim().toLowerCase();
          if (!q) return HEROES;
          return HEROES.filter(h => h.toLowerCase().includes(q));
        }, [query]);

        useEffect(() => {
          function onClickOutside(e) {
            if (!containerRef.current) return;
            if (!containerRef.current.contains(e.target)) {
              setOpen(false);
            }
          }
          window.addEventListener("mousedown", onClickOutside);
          return () => window.removeEventListener("mousedown", onClickOutside);
        }, []);

        function choose(hero) {
          setSelected(hero);
          setQuery(hero);
          setOpen(false);
        }

        const data = selected ? MATCHUPS[selected] : null;

        return (
          <div className="min-h-screen flex items-center justify-center p-6">
            <div className="w-full max-w-3xl">
              <header className="mb-6 text-center">
                <h1 className="text-3xl font-bold">HoN Matchups</h1>
                <p className="text-slate-600">Buscador con imágenes desde carpeta local.</p>
              </header>

              <div className="relative" ref={containerRef}>
                <div className="relative flex justify-center">
                  <input
                    type="text"
                    placeholder="Buscar héroe…"
                    value={query}
                    onChange={(e) => { setQuery(e.target.value); setOpen(true); }}
                    onFocus={() => { if (selected) { setQuery(""); setSelected(null); } setOpen(true); }}
                    className="w-96 max-w-full rounded-2xl border border-slate-200 bg-white pl-4 pr-4 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-400"
                  />
                </div>
                {open && (
                  <ul className="absolute z-10 mt-2 max-h-72 w-96 max-w-full left-1/2 -translate-x-1/2 overflow-auto rounded-2xl border border-slate-200 bg-white p-1 shadow-xl">
                    {filtered.map((hero, idx) => (
                      <li
                        key={hero}
                        onClick={() => choose(hero)}
                        onMouseEnter={() => setHighlight(idx)}
                        className={classNames(
                          "cursor-pointer rounded-xl px-3 py-2 text-sm flex items-center gap-2",
                          idx === highlight ? "bg-sky-50" : ""
                        )}
                      >
                        <Avatar name={hero} />
                        <span>{hero}</span>
                      </li>
                    ))}
                  </ul>
                )}
              </div>

              {selected && (
                <div className="mt-8 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
                  <div className="flex items-center gap-4 mb-4">
                    <Avatar name={selected} size={72} />
                    <h2 className="text-2xl font-semibold">{selected}</h2>
                  </div>

                  <div className="grid gap-4 md:grid-cols-3">
                    <div>
                      <h3 className="font-semibold">Sinergia</h3>
                      <ul className="mt-2 flex flex-col gap-2">
                        {data.synergy.length > 0 ? data.synergy.map((h) => (
                          <li key={h} className="flex items-center gap-2 text-sm text-slate-700">
                            <Avatar name={h} />
                            <span>{h}</span>
                          </li>
                        )) : <li className="text-sm text-slate-400">Sin datos</li>}
                      </ul>
                    </div>
                    <div>
                      <h3 className="font-semibold">Ventaja contra</h3>
                      <ul className="mt-2 flex flex-col gap-2">
                        {data.advantage.length > 0 ? data.advantage.map((h) => (
                          <li key={h} className="flex items-center gap-2 text-sm text-slate-700">
                            <Avatar name={h} />
                            <span>{h}</span>
                          </li>
                        )) : <li className="text-sm text-slate-400">Sin datos</li>}
                      </ul>
                    </div>
                    <div>
                      <h3 className="font-semibold">Desventaja contra</h3>
                      <ul className="mt-2 flex flex-col gap-2">
                        {data.disadvantage.length > 0 ? data.disadvantage.map((h) => (
                          <li key={h} className="flex items-center gap-2 text-sm text-slate-700">
                            <Avatar name={h} />
                            <span>{h}</span>
                          </li>
                        )) : <li className="text-sm text-slate-400">Sin datos</li>}
                      </ul>
                    </div>
                  </div>
                </div>
              )}

              <footer className="mt-10 text-center text-xs text-slate-500">
                v5 — Carga imágenes desde carpeta local /assets/hon/
              </footer>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>