<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HoN Matchups — v27s Stable</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    .scroll-anchor { scroll-margin-top: 16px; }
  </style>
</head>

<body class="bg-slate-900 text-slate-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef, useLayoutEffect } = React;

    /* ================= HERO LIST ================= */
    const HEROES = [
      "Accursed","Amun-Ra","Andromeda","Arachna","Armadon","Behemoth","Blacksmith","Blood Hunter",
      "Bombardier","Bubbles","Chronos","Corrupted Disciple","Defiler","Demented Shaman","Devourer",
      "Doctor Repulsor","Drunken Master","Electrician","Ellonia","Empath","Fayde","Flint Beastwood",
      "Flux","Forsaken Archer","Gauntlet","Gemini","Geomancer","Glacius","Grinex","Gunblade",
      "Hammerstorm","Hellbringer","Jeraziah","Keeper of the Forest","King Klout","Kraken","Legionnaire",
      "Lodestone","Magmus","Magebane","Maliken","Martyr","Midas","Monarch","Monkey King","Moon Queen",
      "Moraxus","Myrmidon","Night Hound","Nomad","Nymphora","Ophelia","Pandamonium","Pebbles",
      "Pestilence","Pharaoh","Plague Rider","Pollywog Priest","Predator","Prophet","Puppet Master",
      "Pyromancer","Rampage","Rhapsody","Riftwalker","Sand Wraith","Scout","Silhouette","Sir Benzington",
      "Slither","Solstice","Soul Reaper","Soulstealer","Swiftblade","Tempest","The Chipper","The Gladiator",
      "The Madman","Thunderbringer","Torturer","Tundra","Valkyrie","Vindicator","Voodoo Jester","War Beast",
      "Witch Slayer","Wretched Hag","Zephyr"
    ].sort();

    /* ================= MATCHUPS ================= */
    const MATCHUPS_BASE = {
      "Accursed": {
        synergy: ["Soul Reaper", "Legionnaire", "Martyr"],
        advantage: ["Moon Queen"],
        disadvantage: ["Night Hound", "Vindicator"]
      },

      "Blacksmith": { synergy: ["Swiftblade", "Moon Queen", "Forsaken Archer"], advantage: [], disadvantage: [] },
      "Blood Hunter": { synergy: [], advantage: ["Thunderbringer", "Wretched Hag"], disadvantage: [] },
      "Arachna": { synergy: ["Slither"], advantage: ["Pyromancer", "Thunderbringer", "Flint Beastwood", "Soulstealer"], disadvantage: ["Magebane"] },
      "Pestilence": { synergy: ["Voodoo Jester"], advantage: ["The Madman", "Grinex", "Scout", "Night Hound", "Predator"], disadvantage: ["Puppet Master"] },
      "Hellbringer": { synergy: ["Voodoo Jester", "Slither", "Magmus"], advantage: [], disadvantage: [] },
      "Magmus": { synergy: ["Myrmidon", "Witch Slayer", "Pollywog Priest", "Jeraziah", "Nymphora"], advantage: [], disadvantage: [] },
      "Voodoo Jester": { synergy: ["Swiftblade","Gemini","Gauntlet"], advantage: [], disadvantage: ["Doctor Repulsor"] },
      "Witch Slayer": {
        synergy: ["Amun-Ra","Magmus","Pandamonium"],
        advantage: ["Armadon","Amun-Ra"],
        disadvantage: ["Swiftblade","Predator","Jeraziah","Moraxus","Pebbles","Gunblade"]
      },
      "Slither": {
        synergy: ["Demented Shaman","Amun-Ra","Swiftblade","Vindicator","Arachna"],
        advantage: ["Armadon"],
        disadvantage: ["The Chipper","Arachna","Predator","Swiftblade","Jeraziah","Accursed","Pebbles"]
      },
      "Pandamonium": {
        synergy: ["Witch Slayer","Voodoo Jester","Monarch"],
        advantage: ["Predator"],
        disadvantage: ["Vindicator","Bubbles","Fayde"]
      },
      "Bubbles": {
        synergy: ["Magmus","Behemoth","Plague Rider"],
        advantage: ["Pandamonium","Voodoo Jester","Monarch","Hammerstorm","Rampage","Myrmidon","Flint Beastwood","Andromeda","Pyromancer"],
        disadvantage: ["Blood Hunter","Gunblade","Night Hound"]
      },
      "Empath": { synergy: ["Predator","Nomad"], advantage: [], disadvantage: [] },
      "Rampage": { synergy: [], advantage: ["Predator"], disadvantage: [] },
      "Pharaoh": { synergy: [], advantage: ["Devourer","Pandamonium","Rampage"], disadvantage: [] },
      "Magebane": { synergy: [], advantage: ["Amun-Ra"], disadvantage: [] },
      "Corrupted Disciple": { synergy: [], advantage: ["Predator"], disadvantage: [] },
      "Glacius": { synergy: ["Devourer","Swiftblade"], advantage: [], disadvantage: [] },
      "Electrician": { synergy: ["Swiftblade"], advantage: [], disadvantage: [] },
      "King Klout": { synergy: [], advantage: ["Devourer","Pandamonium"], disadvantage: [] },
      "Swiftblade": { synergy: [], advantage: ["Predator"], disadvantage: [] },
      "Moraxus": { synergy: [], advantage: ["Pollywog Priest"], disadvantage: [] },
      "Vindicator": { synergy: [], advantage: ["Tempest"], disadvantage: [] },
      "The Chipper": { synergy: [], advantage: ["Thunderbringer","Pyromancer"], disadvantage: [] },
      "Bombardier": { synergy: [], advantage: [], disadvantage: ["Arachna","The Chipper","Accursed","Jeraziah"] },
      "Flux": { synergy: ["Behemoth","Tempest","Soulstealer","Geomancer","Kraken","Solstice","Legionnaire","Hellbringer"], advantage: [], disadvantage: [] },
      "Hammerstorm": { synergy: ["Rhapsody","Glacius","Monarch"], advantage: [], disadvantage: [] },

      /* === ACTUALIZACIÓN: Ophelia es Weak Against Plague Rider === */
      "Ophelia": { synergy: [], advantage: [], disadvantage: ["Glacius","Voodoo Jester","Behemoth","Plague Rider"] }
    };

    /* ================= DERIVE ================= */
    function deriveMatchups(base) {
      const all = new Set(HEROES);
      const out = {};
      for (const h of all) {
        const e = base[h] || {};
        out[h] = {
          synergy: [...new Set(e.synergy || [])],
          advantage: [...new Set(e.advantage || [])],
          disadvantage: [...new Set(e.disadvantage || [])]
        };
      }
      for (const a of Object.keys(out)) {
        for (const b of out[a].synergy) if (all.has(b) && !out[b].synergy.includes(a)) out[b].synergy.push(a);
        for (const b of out[a].advantage) if (all.has(b) && !out[b].disadvantage.includes(a)) out[b].disadvantage.push(a);
        for (const b of out[a].disadvantage) if (all.has(b) && !out[b].advantage.includes(a)) out[b].advantage.push(a);
      }
      for (const h of Object.keys(out)) {
        const clean = a => [...new Set(a.filter(x => x && x !== h))].sort();
        out[h].synergy = clean(out[h].synergy);
        out[h].advantage = clean(out[h].advantage);
        out[h].disadvantage = clean(out[h].disadvantage);
      }
      return out;
    }

    const MATCHUPS = deriveMatchups(MATCHUPS_BASE);

    /* ================= AVATAR ================= */
    function Avatar({ name, size = 24 }) {
      const [i, setI] = useState(0);
      const file = name.replace(/\s+/g, "_");
      const candidates = [
        `./assets/hon/${file}.webp`,
        `./assets/hon/${file}.png`,
        `./assets/hon/${file}.jpg`
      ];
      const src = i < candidates.length ? candidates[i] : null;
      const dim = `${size}px`;
      const initials = name.split(" ").map(p => p[0]).join("").slice(0,2).toUpperCase();
      return (
        <div style={{ width: dim, height: dim }} className="inline-flex items-center justify-center rounded-lg bg-slate-700 text-slate-100 overflow-hidden">
          {src ? (
            <img src={src} alt={name} decoding="async" onError={() => setI(i+1)} style={{ width:"100%",height:"100%",objectFit:"cover" }} />
          ) : (
            <span className="font-semibold" style={{ fontSize: size>32?14:12 }}>{initials}</span>
          )}
        </div>
      );
    }

    /* ================= APP ================= */
    function App(){
      const [query,setQuery]=useState("");
      const [open,setOpen]=useState(false);
      const [selected,setSelected]=useState(null);
      const inputRef=useRef(null);
      const containerRef=useRef(null);
      const panelRef=useRef(null);
      const [panelMinHeight,setPanelMinHeight]=useState(320);
      const touchRef=useRef({active:false,id:null,x:0,y:0,moved:false});
      const TAP_SLOP=6;

      useLayoutEffect(()=>{ if(panelRef.current){ setPanelMinHeight(h=>Math.max(h,panelRef.current.offsetHeight)); }},[selected]);

      const filtered=useMemo(()=>{
        const q=query.trim().toLowerCase();
        return !q?HEROES:HEROES.filter(h=>h.toLowerCase().includes(q));
      },[query]);

      useEffect(()=>{
        function onOutside(e){ if(containerRef.current && !containerRef.current.contains(e.target)) setOpen(false); }
        window.addEventListener("pointerdown",onOutside);
        return()=>window.removeEventListener("pointerdown",onOutside);
      },[]);

      const isTouchDevice = React.useMemo(()=> {
        if (typeof window === "undefined") return false;
        return window.matchMedia && window.matchMedia("(pointer: coarse)").matches;
      },[]);

      const choose=(h)=>{
        setSelected(h);
        setQuery(h);
        setOpen(false);
        setTimeout(()=>inputRef.current?.blur(),0);

        if (isTouchDevice) return; // No scroll programático en móvil

        if (panelRef.current) {
          const rect = panelRef.current.getBoundingClientRect();
          const inView = rect.top >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight);
          if (!inView) panelRef.current.scrollIntoView({ block: "nearest", inline: "nearest", behavior: "smooth" });
        }
      };

      const gestureHandlers=(hero)=>({
        onPointerDown:(e)=>{ if(e.pointerType==="touch"){ touchRef.current={active:true,id:e.pointerId,x:e.clientX,y:e.clientY,moved:false}; } },
        onPointerMove:(e)=>{ const t=touchRef.current; if(t.active&&e.pointerId===t.id){ if(Math.abs(e.clientX-t.x)>TAP_SLOP||Math.abs(e.clientY-t.y)>TAP_SLOP) t.moved=true; } },
        onPointerUp:(e)=>{ const t=touchRef.current;
          if(e.pointerType==="touch"){ if(t.active&&!t.moved){ e.preventDefault(); choose(hero); } t.active=false; }
          else { choose(hero); }
        },
        onPointerCancel:()=>{ touchRef.current.active=false; }
      });

      return (
        <div className="min-h-screen bg-slate-900 text-slate-100 flex items-center justify-center p-6">
          <div className="w-full max-w-3xl">
            <header className="mb-6 text-center">
              {/* LOGO clickeable */}
              <a href="https://heroesofnewerth.com" target="_blank" rel="noopener noreferrer" className="inline-block">
                <img src="./assets/hon/logo_reborn.png" alt="HoN Reborn Logo" className="mx-auto mb-6 h-60 w-auto" decoding="async" />
              </a>
              <h1 className="text-4xl font-bold">HoN Matchups</h1>
              <p className="text-slate-400">Hero synergy and matchup finder</p>
            </header>

            <div className="relative" ref={containerRef}>
              <input
                ref={inputRef}
                type="text"
                placeholder="Search hero..."
                value={query}
                onChange={(e)=>{setQuery(e.target.value); setOpen(true);}}
                onFocus={()=>{ setQuery(""); setOpen(true); }}
                className="w-96 max-w-full rounded-2xl border border-slate-700 bg-slate-800 text-slate-100 pl-4 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-sky-400 mx-auto block"
              />
              {open&&(
                <ul className="absolute z-10 mt-2 max-h-72 w-96 left-1/2 -translate-x-1/2 overflow-auto rounded-2xl border border-slate-700 bg-slate-800 p-1 shadow-xl space-y-0.5">
                  {filtered.map((hero)=>(
                    <li key={hero}>
                      <button type="button" {...gestureHandlers(hero)} className="w-full text-left flex items-center gap-1.5 rounded-xl px-3 py-1.5 text-sm hover:bg-slate-700">
                        <Avatar name={hero}/><span>{hero}</span>
                      </button>
                    </li>
                  ))}
                </ul>
              )}
            </div>

            {selected&&(
              <div ref={panelRef} className="scroll-anchor mt-8 rounded-2xl border border-slate-700 bg-slate-800 p-4" style={{minHeight:panelMinHeight}}>
                <div className="flex items-center gap-4 mb-4">
                  <Avatar name={selected} size={72}/>
                  <h2 className="text-2xl font-semibold">{selected}</h2>
                </div>
                <div className="grid gap-4 md:grid-cols-3">
                  {["synergy","advantage","disadvantage"].map((type)=>(
                    <div key={type}>
                      <h3 className={`font-semibold ${type==="synergy"?"text-sky-300":type==="advantage"?"text-green-400":"text-red-400"}`}>
                        {type==="synergy"?"Best Partners":type==="advantage"?"Strong Against":"Weak Against"}
                      </h3>
                      <ul className="mt-2 flex flex-col gap-2">
                        {MATCHUPS[selected]?.[type]?.length?MATCHUPS[selected][type].map(h=>(
                          <li key={h}>
                            <button type="button" {...gestureHandlers(h)} className="group w-full text-left flex items-center gap-2 rounded-xl px-2 py-1.5 hover:bg-slate-700 transition">
                              <Avatar name={h}/><span>{h}</span>
                            </button>
                          </li>
                        )):<li className="text-sm text-slate-400">No data</li>}
                      </ul>
                    </div>
                  ))}
                </div>
              </div>
            )}

            <footer className="mt-10 text-center text-xs text-slate-400">
              <p>Developed by Nicket</p>
              <p>v1.0 — Stable</p>
            </footer>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
